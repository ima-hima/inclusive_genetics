{"version":3,"file":"minno-sequencer.js","sources":["src/mixer/mixer.js","src/mixer/branching/mixerDotNotationProvider.js","src/mixer/branching/mixerConditionProvider.js","src/mixer/branching/mixerEvaluateProvider.js","src/mixer/branching/mixerBranchingDecorator.js","src/mixer/mixerSequenceProvider.js","src/mixer/branching/dotNotation.js","src/console/piConsole.js","src/mixer/main.js","src/template/templateObjProvider.js","src/template/main.js","src/collection/collectionProvider.js","src/randomizer/randomizerProvider.js","src/store/storeProvider.js","src/databaseSequenceProvider.js","src/databaseProvider.js","src/queryProvider.js","src/inflateProvider.js","src/databaseNoAngular.js"],"sourcesContent":["import _ from 'lodash';\nexport default mixProvider;\n\n/**\n * A function that maps a mixer object into a sequence.\n *\n * The basic structure of such an obect is:\n * {\n *\t\tmixer: 'functionType',\n *\t\tremix : false,\n *\t\tdata: [task1, task2]\n *\t}\n *\n * The results of the mix are set into `$parsed` within the original mixer object.\n * if remix is true $parsed is returned instead of recomputing\n *\n * @param {Object} [obj] [a mixer object]\n * @returns {Array} [An array of mixed objects]\n */\n\nmixProvider.$inject = ['randomizeShuffle', 'randomizeRandom'];\nfunction mixProvider(shuffle, random){\n\n    function mix(obj){\n        var mixerName = obj.mixer;\n\n        // if this isn't a mixer\n        // make sure we catch mixers that are set with undefined by accident...\n        if (!(_.isPlainObject(obj) && 'mixer' in obj)){\n            return [obj];\n        }\n\n        if (_.isUndefined(mix.mixers[mixerName])){\n            throw new Error('Mixer: unknow mixer type = ' + mixerName);\n        }\n\n        if (!obj.remix && obj.$parsed) {\n            return obj.$parsed;\n        }\n\n        obj.$parsed = mix.mixers[mixerName].apply(null, arguments);\n\n        if (!_.isArray(obj.$parsed)) {\n            throw new Error('Mixer: mixers must return an array (mixer: ' + mixerName + ')');\n        }\n\n        return obj.$parsed;\n    }\n\n    function deepMixer(sequence, context){\n        return _.reduce(sequence, function(arr,value){\n\n            if (_.isPlainObject(value) && 'mixer' in value && value.mixer != 'wrapper' && !value.wrapper){\n                var seq = deepMixer(mix(value, context), context);\n                return arr.concat(seq);\n            } else {\n                return arr.concat([value]);\n            }\n        }, []);\n    }\n\n\n    mix.mixers = {\n        wrapper : function(obj){\n            return obj.data;\n        },\n\n        repeat: function(obj){\n            var sequence = obj.data || [];\n            var result = [], i;\n            for (i=0; i < obj.times; i++){\n                result = result.concat(_.clone(sequence,true));\n            }\n            return result;\n        },\n\n        // randomize any elements\n        random: function(obj, context){\n            var sequence = obj.data ? deepMixer(obj.data, context) : [];\n            return shuffle(sequence);\n        },\n\n        choose: function(obj, context){\n            var sequence = obj.data ? deepMixer(obj.data, context) : [];\n            return _.take(shuffle(sequence), obj.n ? obj.n : 1);\n        },\n\n        custom: function(obj, context){\n            return _.isFunction(obj.fn) ? obj.fn(obj, context) : [];\n        },\n\n        weightedRandom: weightedChoose,\n        weightedChoose: weightedChoose\n\n    };\n\n\n    return mix;\n\n    function weightedChoose(obj, context){\n        var sequence = obj.data ? deepMixer(obj.data, context) : [];\n        var i;\n        var n = obj.n || 1;\n        var result = [];\n        var total_weight = _.reduce(obj.weights,function (prev, cur) {\n            return prev + cur;\n        });\n\n        for (i = 0; i < n; i++){\n            result.push(generate());\n        }\n\n        return result;\n\n        function generate(){\n            var i;\n            var random_num = random() * total_weight; // cutoff - when we reach this sum - we've reached the desired weight\n            var weight_sum = 0;\n\n            for (i = 0; i < sequence.length; i++) {\n                weight_sum += obj.weights[i];\n                weight_sum = +weight_sum.toFixed(3);\n\n                if (random_num <= weight_sum) {\n                    return obj.data[i];\n                }\n            }\n\n            throw new Error('Mixer: something went wrong with weightedRandom');\n        }\n    }\n\n}\n","import _ from 'lodash';\nexport default mixerDotNotationProvider;\n\nmixerDotNotationProvider.$inject = ['dotNotation'];\nfunction mixerDotNotationProvider(dotNotation){\n\n    function mixerDotNotation(chain, obj){\n\n        var escapeSeparatorRegex= /[^/]\\./;\n\n        if (!_.isString(chain)) return chain;\n\n        // We do not have a non escaped dot: we treat this as a string\n        if (!escapeSeparatorRegex.test(chain)) return chain.replace('/.','.');\n\n        return dotNotation(chain, obj);\n    }\n\n    return mixerDotNotation;\n}\n","import _ from 'lodash';\n\nexport default mixerConditionProvider;\n\nmixerConditionProvider.$inject = ['mixerDotNotation','piConsole'];\nfunction mixerConditionProvider(dotNotation,piConsole){\n    var operatorHash = {\n        gt: forceNumeric(_.gt),\n        greaterThan: forceNumeric(_.gt),\n        gte: forceNumeric(_.gte),\n        greaterThanOrEqual: forceNumeric(_.gte),\n        equals: _.eq,\n        'in': _.rearg(_.contains,1,0), // effectively reverse\n        contains: _.rearg(_.contains,1,0), // effectively reverse\n        exactly: exactly,\n        isTruthy: isTruthy\n    };\n\n    function mixerCondition(condition, context){\n        var operator = getOperator(condition);\n        var left = dotNotation(condition.compare,context);\n        var right = dotNotation(condition.to,context);\n\n        if (condition.DEBUG) piConsole({\n            type:'info',\n            message:'Condition info',\n            rows: [\n                ['Left: ', left], \n                ['Operator: ', condition.operator || 'equals'],\n                ['Right: ', right]\n            ],\n            context: condition,\n        });\n\n        return condition.negate\n            ? !operator.apply(context,[left, right, context])\n            : operator.apply(context,[left, right, context]);\n    }\n\n    return mixerCondition;\n\n\n    // extract the operator function from the condition\n    function getOperator(condition){\n        var operator = condition.operator;\n        if (_.isFunction(condition)) return condition;\n        if (!_.has(condition, 'operator')) return _.has(condition,'to') ? _.eq : isTruthy;\n        if (_.isFunction(operator)) return operator;\n        return operatorHash[operator];\n    }\n\n    function isTruthy(left){ return !!left; }\n    function exactly(left,right){ return left === right;}\n    function forceNumeric(cb){ return function(left,right){ return [left,right].every(_.isNumber) ? cb(left,right) : false; }; } \n\n}\n","import _ from 'lodash';\nexport default evaluateProvider;\n\nevaluateProvider.$inject = ['mixerCondition'];\nfunction evaluateProvider(condition){\n    /**\n     * Checks if a conditions set is true\n     * @param  {Array} conditions [an array of conditions]\n     * @param  {Object} context   [A context for the condition checker]\n     * @return {Boolean}          [Are these conditions true]\n     */\n\n    function evaluate(conditions,context){\n        // make && the default\n        _.isArray(conditions) && (conditions = {and:conditions});\n\n        function test(cond){return evaluate(cond,context);}\n\n        // && objects\n        if (conditions.and){\n            return _.every(conditions.and, test);\n        }\n        if (conditions.nand){\n            return !_.every(conditions.nand, test);\n        }\n\n        // || objects\n        if (conditions.or){\n            return _.some(conditions.or, test);\n        }\n        if (conditions.nor){\n            return !_.some(conditions.nor, test);\n        }\n\n        return condition(conditions, context);\n    }\n\n    return evaluate;\n}\n","/**\n * Registers the branching mixers with the mixer\n * @return {function}         [mixer decorator]\n */\n\nimport _ from 'lodash';\n\nexport default mixerBranchingDecorator;\n\nmixerBranchingDecorator.$inject = ['$delegate','mixerEvaluate','mixerDefaultContext'];\nfunction mixerBranchingDecorator(mix, evaluate, mixerDefaultContext){\n\n    mix.mixers.branch = branch;\n    mix.mixers.multiBranch = multiBranch;\n\n    return mix;\n\n    /**\n     * Branching mixer\n     * @return {Array}         [A data array with objects to continue with]\n     */\n    function branch(obj, context){\n        context = _.extend(context || {}, mixerDefaultContext);\n        return evaluate(obj.conditions, context) ? obj.data || [] : obj.elseData || [];\n    }\n\n    /**\n     * multiBranch mixer\n     * @return {Array}         [A data array with objects to continue with]\n     */\n    function multiBranch(obj, context){\n        context = _.extend(context || {}, mixerDefaultContext);\n        var row;\n\n        row = _.find(obj.branches, function(branch){\n            return evaluate(branch.conditions, context);\n        });\n\n        if (row) {\n            return row.data || [];\n        }\n\n        return obj.elseData || [];\n    }\n}\n","import _ from 'lodash';\nexport default mixerSequenceProvider;\n\nmixerSequenceProvider.$inject = ['mixer'];\nfunction mixerSequenceProvider(mix){\n\n    /**\n     * MixerSequence takes an mixer array and allows browsing back and forth within it\n     * @param {Array} arr [a mixer array]\n     */\n    function MixerSequence(arr){\n        this.sequence = arr;\n        this.stack = [];\n        this.add(arr);\n        this.pointer = 0;\n    }\n\n    _.extend(MixerSequence.prototype, {\n        /**\n         * Add sequence to mixer\n         * @param {[type]} arr     Sequence\n         * @param {[type]} reverse Whether to start from begining or end\n         */\n        add: function(arr, reverse){\n            this.stack.push({pointer:reverse ? arr.length : -1,sequence:arr});\n        },\n\n        proceed: function(direction, context){\n            // get last subSequence\n            var subSequence = this.stack[this.stack.length-1];\n            var isNext = (direction === 'next');\n\n            // if we ran out of sequence\n            // add the original sequence back in\n            if (!subSequence) {\n                throw new Error ('mixerSequence: subSequence not found');\n            }\n\n            subSequence.pointer += isNext ? 1 : -1;\n\n            var el = subSequence.sequence[subSequence.pointer];\n\n            // if we ran out of elements, go to previous level (unless we are on the root sequence)\n            if (_.isUndefined(el) && this.stack.length > 1){\n                this.stack.pop();\n                return this.proceed.call(this,direction,context);\n            }\n\n            // if element is a mixer, mix it\n            if (el && el.mixer){\n                this.add(mix(el,context), !isNext);\n                return this.proceed.call(this,direction,context);\n            }\n\n            // regular element or undefined (end of sequence)\n            return this;\n        },\n\n        next: function(context){\n            this.pointer++;\n            return this.proceed.call(this, 'next',context);\n        },\n\n        prev: function(context){\n            this.pointer--;\n            return this.proceed.call(this, 'prev',context);\n        },\n\n        /**\n         * Return current element\n         * should **never** return a mixer - supposed to abstract them away\n         * @return {[type]} undefined or element\n         */\n        current:function(){\n            // get last subSequence\n            var subSequence = this.stack[this.stack.length-1];\n\n            if (!subSequence) {\n                throw new Error ('mixerSequence: subSequence not found');\n            }\n\n            var el = subSequence.sequence[subSequence.pointer];\n\n            if (!el){\n                return undefined;\n            }\n\n            // extend element with meta data\n            el.$meta = this.meta();\n\n            return el;\n        },\n\n        meta: function(){\n            return {\n                number: this.pointer,\n\n                // sum of sequence length, minus one (the mixer) for each level of stack except the last\n                outOf:  _.reduce(this.stack, function(memo,sub){return memo + sub.sequence.length-1;},0)+1\n            };\n        }\n\n    });\n\n    return MixerSequence;\n}\n","import _ from 'lodash';\nexport default dotNotation;\n\nfunction dotNotation(chain, obj){\n\n    if (_.isUndefined(chain)) return;\n    if (_.isString(chain)) chain = chain.split('.');\n\n    // @TODO maybe lodash _.get?\n    return chain.reduce(function(result, link){\n\n        if (_.isPlainObject(result) || _.isArray(result)){\n            return result[link];\n        }\n\n        return undefined;\n\n    }, obj);\n}\n","import _ from 'lodash';\n\nexport default piConsoleFactory;\n\npiConsoleFactory.$inject = ['$log'];\nfunction piConsoleFactory($log){\n    return window.DEBUG ? piConsole : _.noop;\n\n    function piConsole(log){\n        if (_.get(piConsole,'settings.hideConsole', false)) return window.postMessage({type:'kill-console'},'*');\n\n        $log[log.type] && $log[log.type](log.message); \n        window.postMessage(noramlizeMessage(log),'*');\n    }\n\n    function noramlizeMessage(obj){\n        return _.cloneDeep(obj, normalize);\n        function normalize(val){\n            if (_.isFunction(val)) return val.toString();\n            if (_.isError(val)) return {name:val.name, message:val.message, stack:val.stack};\n        }\n    }\n}\n","import _ from 'lodash';\n\nimport Mixer from './mixer';\nimport mixerDotNotationProvider from './branching/mixerDotNotationProvider';\nimport mixerConditionProvider from './branching/mixerConditionProvider';\nimport mixerEvaluateProvider from './branching/mixerEvaluateProvider';\nimport mixerBranchingDecorator from './branching/mixerBranchingDecorator';\nimport mixerSequenceProvider from './mixerSequenceProvider';\nimport dotNotation from './branching/dotNotation'; // this is a value, doesn't need to be evaluated\nimport piConsoleFactory from '../console/piConsole';\n\nexport default MixerSequence;\n\nvar piConsole = piConsoleFactory(console);\nvar mixer = Mixer(\n    _.shuffle, // randomizeShuffle\n    Math.random // randomizeRandom\n);\n\nvar mixerDotNotation = mixerDotNotationProvider(dotNotation);\nvar mixerCondition = mixerConditionProvider(\n    mixerDotNotation,\n    piConsole\n);\n\nvar mixerEvaluate = mixerEvaluateProvider(mixerCondition);\n\nvar mixerDefaultContext = {};\n\nmixerBranchingDecorator(\n    mixer,\n    mixerEvaluate,\n    mixerDefaultContext\n);\n\nvar MixerSequence = mixerSequenceProvider(mixer);\n","import _ from 'lodash';\nexport default templateObjProvider;\n\ntemplateObjProvider.$inject = ['templateDefaultContext'];\nfunction templateObjProvider(templateDefaultContext){\n\n    function templateObj(obj, context, options){\n        var skip = _.get(options, 'skip', []);\n        var result = {};\n        var key;\n        var ctx = _.assign({}, context, templateDefaultContext);\n\n        for (key in obj){\n            result[key] = (skip.indexOf(key) == -1) ? expand(obj[key]) : obj[key];\n        }\n\n        return result;\n\n        function expand(value){\n            if (_.isString(value)) return template(value);\n            if (_.isArray(value)) return value.map(expand);\n            if (_.isPlainObject(value)) return _.mapValues(value, expand);\n            return value;\n        }\n\n        function template(input){\n            // if there is no template just return the string\n            if (!~input.indexOf('<%')) return input;\n            return _.template(input)(ctx);\n        }\n    }\n\n    return templateObj;\n}\n","import templateObjProvider from './templateObjProvider';\n\nexport default templateObjProvider({}); \n\n","import _ from 'lodash';\nexport default collectionService;\n/*\n * The constructor for an Array wrapper\n */\n\nfunction collectionService(){\n\n    function Collection (arr) {\n        if (arr instanceof Collection) {\n            return arr;\n        }\n\n        // Make sure we are creating this array out of a valid argument\n        if (!_.isUndefined(arr) && !_.isArray(arr) && !(arr instanceof Collection)) {\n            throw new Error('Collections can only be constructed from arrays');\n        }\n\n        this.collection = arr || [];\n        this.length = this.collection.length;\n\n        // pointer to the current location within the array\n        // we start with -1 so that the initial next points to the begining of the array\n        this.pointer = -1;\n    }\n\n    _.extend(Collection.prototype,{\n\n        first : function first(){\n            this.pointer = 0;\n            return this.collection[this.pointer];\n        },\n\n        last : function last(){\n            this.pointer = this.collection.length - 1;\n            return this.collection[this.pointer];\n        },\n\n        end : function end(){\n            this.pointer = this.collection.length;\n            return undefined;\n        },\n\n        current : function(){\n            return this.collection[this.pointer];\n        },\n\n        next : function(){\n            return this.collection[++this.pointer];\n        },\n\n        previous : function(){\n            return this.collection[--this.pointer];\n        },\n\n        // add list of items to the collection\n        add : function(list){\n            // dont allow adding nothing\n            if (!arguments.length) {\n                return this;\n            }\n\n            // make sure list is as an array\n            list = _.isArray(list) ? list : [list];\n            this.collection = this.collection.concat(list);\n\n            this.length = this.collection.length;\n\n            return this;\n        },\n\n        // return the item at index\n        at: function(index){\n            return this.collection[index];\n        }\n    });\n\n\n    // Stuff we took out of bootstrap that can augment the collection\n    // **************************************************************\n    var methods = ['where','filter'];\n    var slice = Array.prototype.slice;\n\n    // Mix in each Underscore method as a proxy to `Collection#models`.\n    _.each(methods, function(method) {\n        Collection.prototype[method] = function() {\n            var args = slice.call(arguments);\n            args.unshift(this.collection);\n            var coll = _[method].apply(_,args);\n            return new Collection(coll);\n        };\n    });\n\n    return Collection;\n}\n","import _ from 'lodash';\nexport default RandomizerProvider;\n\n// @TODO: repeat currently repeats only the last element, we need repeat = 'set' or something in order to prevent re-randomizing of exRandom...\n\nRandomizerProvider.$inject = ['randomizeInt', 'randomizeRange', 'Collection'];\nfunction RandomizerProvider(randomizeInt, randomizeRange, Collection){\n\n    function Randomizer(){\n        this._cache = {\n            random : {},\n            exRandom : {},\n            sequential : {}\n        };\n    }\n\n    _.extend(Randomizer.prototype, {\n        random: random,\n        exRandom: exRandom,\n        sequential: sequential\n    });\n\n    return Randomizer;\n\n    function random(length, seed, repeat){\n        var cache  = this._cache.random;\n\n        if (repeat && !_.isUndefined(cache[seed])) {\n            return cache[seed];\n        }\n\n        // save result in cache\n        cache[seed] = randomizeInt(length);\n\n        return cache[seed];\n    }\n\n    function sequential(length, seed, repeat){\n        var cache = this._cache.sequential;\n        var coll = cache[seed];\n        var result;\n\n        // if needed create collection and set it in seed\n        if (_.isUndefined(coll)){\n            coll = cache[seed] = new Collection(_.range(length));\n            return coll.first();\n        }\n\n        if (coll.length !== length){\n            throw new Error('This seed  ('+ seed +') points to a collection with the wrong length, you can only use a seed for sets of the same length');\n        }\n\n        // if this is a repeated element:\n        if (repeat) {\n            return coll.current();\n        }\n\n        // if we've reached the end\n        result = coll.next();\n\n        // if we've reached the end of the collection (next)\n        if (_.isUndefined(result)){\n            return coll.first();\n        } else {\n            return result;\n        }\n    }\n\n    function exRandom(length, seed, repeat){\n        var cache = this._cache.exRandom;\n        var coll = cache[seed];\n        var result;\n\n        // if needed create collection and set it in seed\n        if (_.isUndefined(coll)){\n            coll = cache[seed] = new Collection(randomizeRange(length));\n            return coll.first();\n        }\n\n        if (coll.length !== length){\n            throw new Error('This seed  ('+ seed +') points to a collection with the wrong length, you can only use a seed for sets of the same length');\n        }\n\n        // if this is a repeated element:\n        if (repeat) {\n            return coll.current();\n        }\n\n        // if we've reached the end\n        result = coll.next();\n\n        // if we've reached the end of the collection (next)\n        // we should re-randomize\n        if (_.isUndefined(result)){\n            coll = cache[seed] = new Collection(randomizeRange(length));\n            return coll.first();\n        } else {\n            return result;\n        }\n    }\n\n}\n","/*\n *\tThe store is a collection of collection devided into namespaces.\n *\tYou can think of every namespace/collection as a table.\n */\nimport _ from 'lodash';\nexport default storeProvider;\n\nstoreProvider.$inject = ['Collection'];\nfunction storeProvider(Collection){\n\n    function Store(){\n        this.store = {};\n    }\n\n    _.extend(Store.prototype, {\n        create: function create(nameSpace){\n            if (this.store[nameSpace]){\n                throw new Error('The name space ' + nameSpace + ' already exists');\n            }\n            this.store[nameSpace] = new Collection();\n            this.store[nameSpace].namespace = nameSpace;\n        },\n\n        read: function read(nameSpace){\n            if (!this.store[nameSpace]){\n                throw new Error('The name space ' + nameSpace + ' does not exist');\n            }\n            return this.store[nameSpace];\n        },\n\n        update: function update(nameSpace, data){\n            var coll = this.read(nameSpace);\n            coll.add(data);\n        },\n\n        del: function del(nameSpace){\n            this.store[nameSpace] = undefined;\n        }\n    });\n\n    return Store;\n}\n","import _ from 'lodash';\nexport default SequenceProvider;\n\nSequenceProvider.$inject = ['MixerSequence'];\nfunction SequenceProvider(MixerSequence){\n\n    /**\n     * Sequence Constructor:\n     * Manage the progression of a sequence, including parsing (mixing, inheritance and templating).\n     * @param  {String  } namespace [pages or questions (the type of db.Store)]\n     * @param  {Array   } arr       [a sequence to manage]\n     * @param  {Database} db        [the db itself]\n     */\n\n    function Sequence(namespace, arr,db){\n        this.namespace = namespace;\n        this.mixerSequence = new MixerSequence(arr);\n        this.db = db;\n    }\n\n    _.extend(Sequence.prototype, {\n        // only mix\n        next: function(context){\n            this.mixerSequence.next(context);\n            return this;\n        },\n\n        // anti mix\n        prev: function(context){\n            this.mixerSequence.prev(context);\n            return this;\n        },\n\n        /**\n         * Return the element currently in focus.\n         * It always returns either an element or undefined (mixers are abstrcted away)\n         * @param  {[type]} context [description]\n         * @return {[type]}         [description]\n         */\n        current: function(context, options){\n            context || (context = {});\n            // must returned an element or undefined\n            var obj = this.mixerSequence.current(context);\n\n            // in case this is the end of the sequence\n            if (!obj){\n                return obj;\n            }\n\n            return this.db.inflate(this.namespace, obj, context, options);\n        },\n\n        /**\n         * Returns an array of elements, created by proceeding through the whole sequence.\n         * @return {[type]} [description]\n         */\n        all: function(context, options){\n            var sequence = [];\n\n            var el = this.next().current(context, options);\n            while (el){\n                sequence.push(el);\n                el = this.next().current(context, options);\n            }\n\n            return sequence;\n        }\n    });\n\n    return Sequence;\n}\n","import _ from 'lodash';\nexport default DatabaseProvider;\n\nDatabaseProvider.$inject = ['DatabaseStore', 'DatabaseRandomizer', 'databaseInflate', 'templateObj', 'databaseSequence','piConsole'];\nfunction DatabaseProvider(Store, Randomizer, inflate, templateObj, DatabaseSequence, piConsole){\n\n    function Database(){\n        this.store = new Store();\n        this.randomizer = new Randomizer();\n    }\n\n    _.extend(Database.prototype, {\n        createColl: function(namespace){\n            this.store.create(namespace);\n        },\n\n        getColl: function(namespace){\n            return this.store.read(namespace);\n        },\n\n        add: function(namespace, query){\n            var coll = this.store.read(namespace);\n            coll.add(query);\n        },\n\n        inflate: function(namespace, query, context, options){\n            var coll = this.getColl(namespace);\n            var result;\n\n            // inherit\n            try {\n                if (!query.$inflated || query.reinflate) {\n                    query.$inflated = inflate(query, coll, this.randomizer);\n                    query.$templated = null; // we have to retemplate after querying, who know what new templates we got here...\n                }\n            } catch(err) {\n                piConsole({\n                    type:'error',\n                    message: 'Failed to inherit',\n                    error:err,\n                    context: query\n                });\n                if (this.onError) this.onError(err);\n                throw err;\n            }\n\n            // template\n            try {\n                if (!query.$templated || query.$inflated.regenerateTemplate){\n                    context[namespace + 'Meta'] = query.$meta;\n                    context[namespace + 'Data'] = templateObj(query.$inflated.data || {}, context, options); // make sure we support\n                    query.$templated = templateObj(query.$inflated, context, options);\n                }\n            } catch(err) {\n                piConsole({\n                    type:'error',\n                    message: 'Failed to apply template',\n                    error:err,\n                    context: query.$inflated\n                });\n                if (this.onError) this.onError(err);\n                throw err;\n            }\n\n            result = query.$templated;\n\n            // set flags\n            if (context.global && result.addGlobal) _.extend(context.global, result.addGlobal);\n\n            if (context.current && result.addCurrent) _.extend(context.current, result.addCurrent);\n\n            return result;\n        },\n\n        sequence: function(namespace, arr){\n            if (!_.isArray(arr)){\n                throw new Error('Sequence must be an array.');\n            }\n            return new DatabaseSequence(namespace, arr, this);\n        }\n    });\n\n    return Database;\n}\n","import _ from 'lodash';\nexport default queryProvider;\n\nqueryProvider.$inject = ['Collection'];\nfunction queryProvider(Collection){\n\n    function queryFn(query, collection, randomizer){\n        var coll = new Collection(collection);\n\n        // shortcuts:\n        // ****************************\n\n        if (_.isFunction(query)) return query(collection);\n\n        if (_.isString(query) || _.isNumber(query)) query = {set:query, type:'random'};\n\n        // filter by set\n        // ****************************\n        if (query.set) coll = coll.where({set:query.set});\n\n        // filter by data\n        // ****************************\n        if (_.isString(query.data)){\n            coll = coll.filter(function(q){\n                return q.handle === query.data || (q.data && q.data.handle === query.data);\n            });\n        }\n\n        if (_.isPlainObject(query.data)) coll = coll.where({data:query.data});\n\n        if (_.isFunction(query.data)) coll = coll.filter(query.data);\n\n        // pick by type\n        // ****************************\n\n        // the default seed is namespace specific just to minimize the situations where seeds clash across namespaces\n        var seed = query.seed || ('$' + collection.namespace + query.set);\n        var length = coll.length;\n        var repeat = query.repeat;\n        var at;\n\n        switch (query.type){\n            case undefined:\n            case 'byData':\n            case 'random':\n                at = randomizer.random(length,seed,repeat);\n                break;\n            case 'exRandom':\n                at = randomizer.exRandom(length,seed,repeat);\n                break;\n            case 'sequential':\n                at = randomizer.sequential(length,seed,repeat);\n                break;\n            case 'first':\n                at = 0;\n                break;\n            case 'last':\n                at = length-1;\n                break;\n            default:\n                throw new Error('Unknow query type: ' + query.type);\n        }\n\n        if (_.isUndefined(coll.at(at))) throw new Error('Query failed, object (' + JSON.stringify(query) +\t') not found. If you are trying to apply a template, you should know that they are not supported for inheritance.');\n\n        return coll.at(at);\n    }\n\n    return queryFn;\n}\n","/*\n * inflates an object\n * this function is responsible for inheritance\n *\n * function inflate(source,coll, randomizer, recursive, counter)\n * @param source: the object to inflate\n * @param coll: a collection to inherit from\n * @param randomizer: a randomizer object for the query\n * @param recursive: private use only, is this inside the recursion (true) or top level (false)\n * @param depth: private use only, a counter for the depth of the recursion\n */\nimport _ from 'lodash';\nexport default inflateProvider;\n\ninflateProvider.$inject = ['databaseQuery','$rootScope'];\nfunction inflateProvider(query, $rootScope){\n\n    function customize(source){\n        // check for a custom function and run it if it exists\n        if (_.isFunction(source.customize)){\n            source.customize.apply(source, [source, $rootScope.global]);\n        }\n        return source;\n    }\n\n    // @param source - object to inflate\n    // @param type - trial stimulus or media\n    // @param recursive - whether this is a recursive call or not\n    function inflate(source, coll, randomizer, recursive, depth){\n\n        // protection against infinte loops\n        // ***********************************\n        depth = recursive ? --depth : 10;\n\n        if (!depth) throw new Error('Inheritance loop too deep, you can only inherit up to 10 levels down');\n\n        if (!_.isPlainObject(source)) throw new Error('You are trying to inflate a non object (' + JSON.stringify(source) + ')');\n\n        var parent;\n        var child = _.cloneDeep(source);\n        var inheritObj = child.inherit;\n\n        /*\n         * no inheritance\n         */\n\n        if (!child.inherit) {\n            if (!recursive) customize(child); // customize only on the last call (non recursive)\n            return child;\n        }\n\n        /*\n         * get parent\n         */\n        parent = query(inheritObj, coll, randomizer);\n\n        // if inherit target was not found\n        if (!parent) throw new Error('Query failed, object (' + JSON.stringify(inheritObj) +\t') not found.');\n\n        // inflate parent (recursively)\n        parent = inflate(\n            parent,\n            coll,\n            randomizer,\n            true,\n            depth\n        );\n\n        // extending the child\n        // ***********************************\n        if (inheritObj.merge && !_.isArray(inheritObj.merge)){\n            throw new Error('Inheritance error: inherit.merge must be an array.');\n        }\n\n        // start inflating child (we have to extend selectively...)\n        _.each(parent, function(value, key){\n            var childProp, parentProp;\n            // if this key is not set yet, copy it out of the parent\n            if (!(key in child)){\n                child[key] = _.isFunction(value) ? value : _.cloneDeep(value);\n                return;\n            }\n\n            // if we have a merge array,\n            if (_.indexOf(inheritObj.merge, key) != -1){\n                childProp = child[key];\n                parentProp = value;\n\n                if (_.isArray(childProp)){\n                    if (!_.isArray(parentProp)){\n                        throw new Error('Inheritance error: You tried merging an array with an non array (for \"' + key + '\")');\n                    }\n                    child[key] = childProp.concat(parentProp);\n                }\n\n                if (_.isPlainObject(childProp)){\n                    if (!_.isPlainObject(parentProp)){\n                        throw new Error('Inheritance error: You tried merging an object with an non object (for \"' + key + '\")');\n                    }\n                    child[key] = _.extend({},parentProp,childProp);\n                }\n\n            }\n        });\n\n        // we want to extend the childs data even if it already exists\n        // its ok to shallow extend here (because by definition parent was created for this inflation)\n        if (parent.data){\n            child.data = _.extend(parent.data, child.data || {});\n        }\n\n        // Personal customization functions - only if this is the last iteration of inflate\n        // This way the customize function gets called only once.\n        !recursive && customize(child);\n\n        // return inflated trial\n        return child;\n    }\n\n    return inflate;\n}\n","import _ from 'lodash';\nvar global = window.piGlobal;\n\nimport mixerSequence from './mixer/main';\nimport templateObj from './template/main';\nimport collectionProvider from './collection/collectionProvider';\nimport randomizerProvider from './randomizer/randomizerProvider';\n\nimport storeProvider from './store/storeProvider';\nimport databaseSequenceProvider from './databaseSequenceProvider';\nimport databaseProvider from './databaseProvider';\nimport queryProvider from './queryProvider';\nimport inflateProvider from './inflateProvider';\n\nimport piConsoleFactory from './console/piConsole';\nexport default Database;\n\nvar piConsole = piConsoleFactory(console);\nvar collection = collectionProvider();\n\nvar DatabaseRandomizer = randomizerProvider(\n    randomInt,// randomize int\n    randomArr,// randomize range\n    collection\n);\n\nvar databaseQuery = queryProvider(\n    collection,\n    piConsole\n);\n\nvar databaseInflate = inflateProvider(\n    databaseQuery,\n    {global: global}, // rootscope\n    piConsole\n);\n\nvar DatabaseStore = storeProvider(\n    collection\n);\n\nvar databaseSequence = databaseSequenceProvider(\n    mixerSequence\n);\n\nvar Database = databaseProvider(\n    DatabaseStore,\n    DatabaseRandomizer,\n    databaseInflate,\n    templateObj,\n    databaseSequence,\n    piConsole\n);\n\nfunction randomArr(length){\n    return _.shuffle(_.range(length));\n}\n\nfunction randomInt(length){\n    return Math.floor(Math.random()*length);\n}\n"],"names":["mixerDotNotationProvider","mixerConditionProvider","mixerBranchingDecorator","mixerSequenceProvider","dotNotation","piConsoleFactory","piConsole","Mixer","mixerEvaluateProvider","templateObjProvider","storeProvider","queryProvider","inflateProvider","collectionProvider","randomizerProvider","databaseSequenceProvider","mixerSequence","databaseProvider"],"mappings":"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"}